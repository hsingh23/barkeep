#!/usr/bin/env node

var program = require('commander');
var open = require('open');
var fs = require('fs');
var path = require('path');

var barkeep = require('..');
var packageJSON = require('../package.json');

program
  .version(packageJSON.version)
  .option('-p, --port [9091]', 'The port to serve the files over', parseInt)
  .option('-l, --lrport [35729]', 'The port that livereload will run on', parseInt)
  .parse(process.argv);

barkeep(process.cwd())
  .listen(program.port, program.lrport, onListening);

function onListening() {
  var ip = this.address().address;
  var port = this.address().port;
  var address = 'http://' + ip + ':' + port
  console.log('Listening at ' + address);

  // If there is an index.html file at the cwd, open a browser
  if (fs.existsSync(path.join(process.cwd(), 'index.html'))) {
    open(address);
  }
}

